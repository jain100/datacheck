{% load staticfiles %}

<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <link rel="stylesheet" href="{% static 'dizz_modified.css' %}">

    <link rel="icon" type="/image/png" href="{% static 'icon.png' %}"> 

    <title>Title of the page</title>

    <style>
    .axis text{
      font-family: Helvetica, Arial, sans-serif;
      font-size: 12px;
      text-anchor: end;
    }
    .axis path{
      fill:none;
      stroke:black;
      stroke-width: 0.5px;
      shape-rendering: crispEdges;
    }
    .bar{
        stroke: none;
        fill: steelblue;
    }
    .textlabel{
        font-family: Helvetica, Arial, sans-serif;
        font-size:14px;
        text-anchor: middle;
    }
</style>



  </head>
  <body>
    
    <header>
      <div class="intro">
        <div class="intro-content">
            <img src="{% static 'icon.png' %}" height="35px" width="35px"><h3>WELCOME</h3>
        </div>
      </div>
      <div class="menu">
        <ul>
          <li><a>HOME</a></li>
          <li><a>SETUP</a></li>
          <li><a>SIGN UP</a></li>
          <li><a>LOG IN</a></li>
        </ul>
      </div>
    </header>

    <section>
      <div class="row">
          <div class="col-4">
            <div class="left-menu">
                <fieldset class="the-fieldset">
                  <legend class="the-legend">
                  <strong><span class="navy">CUSTOMER</span></strong>
                  </legend>
                  <details>
                    <summary><strong><span class="blue">MODEL</span></strong></summary>
                      <p><a id="churn_u"><span id="churn" class="green">Likely to churn model</span></a></p>
                      <p><a id="lapse_u"><span id="lapse" class="green">Likely to Lapse model</span></a></p>
                      <p><a id="drop_u"><span id="drop" class="green">Usage Drop model</span></a></p>
                      <p><a id="pay_u"><span id="pay" class="green">Likely to pay model</span></a></p>
                  </details>
                  <details>
                    <summary><strong><span class="blue">Segmentation</span></strong></summary>
                      <p><a id="behave_u"><span id="behave" class="green">Behavoiral Segmentation</span></a></p>
                      <p><a id="value_u"><span id="value" class="green">Value Segmentation</span></a></p>
                      <p><a id="life_u"><span id="life" class="green">Life time value Segmentation</span></a></p>
                  </details>
                </fieldset>
                <fieldset class="the-fieldset">
                  <legend class="the-legend">
                  <strong><span class="blue">GAME</span></strong>
                  </legend>
                  <details>
                  <summary><strong><span class="blue">MODEL</span></strong></summary>
                      <p><a id="feature_u"><span id="feature" class="green">Feature Affinity Model</span></a></p>
                      <p><a id="match_level_u"><span id="match_level" class="green">Match-3 Level Generation</span></a></p>
                      <p><a id="match_u"><span id="match" class="green">Match Making</span></a></p>
                  </details>
                </fieldset>
                <fieldset class="the-fieldset">
                  <legend class="the-legend">
                  <strong><span class="blue">EXPERIMENT</span></strong>
                  </legend>
                  <p><a id="exp_op_u"><span id="exp_op" class="green">Experiment Optimization</span></a></p>
                </fieldset>
                <fieldset class="the-fieldset">
                  <legend class="the-legend">
                  <strong><span class="blue">GAME SERVICES</span></strong>
                  </legend>
                  <p><a id="ai_driven_u"><span id="ai_driven" class="green">AI-Driven In-Game Asset (Art)Chat Bot</span></a></p>
                </fieldset>
            </div>
          </div>
          <div class="col-8">
            <div class="row">
              <div class="col-12">
                <h2 id="title">LIKELY TO LAPSE MODEL</h2>
              </div>
            </div>
            <div>


              <h5>Steps: </h5>
              <ol div="list-group">
                <li class="list-group-item"><a>1. Upload Data</a></li>
                <li class="list-group-item"><a>2. Generate Summary</a></li>
                <li class="list-group-item"><a>3. Build Model</a>
                  <ul>
                    <li><a>Model Performance Report</a></li>
                    <li><a>Variable Importance Report</a></li>
                  </ul>
                </li>
                <li class="list-group-item"><a>4. Deploy Model</a></li>
              </ol>
              <h5><span class="dark-red">Help: </span><span class="red">Click on the link to learn how to prepare data</span></h5> 
            </div>
          </div>
      </div>
    </section>

    <section>

    </section>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <svg width="960" height="500"></svg>

<script src="https://d3js.org/d3.v4.min.js"></script>
<!-- <script>
  
    var s = d3.select('body').append('select')
    s.append('option').text('all');
    s.append('option').text('x');
    s.append('option').text('y');
    s.append('option').text('z');
  
    s.on('change',function(){
      var key = this.options[this.selectedIndex].value;
      d3.selectAll('.lineGroup').each(function(d,i){
        if (d.key === key || key === 'all'){
          d3.select('.' + d.key).style('opacity',1);
        }else{
          d3.select('.' + d.key).style('opacity',0);
        }
      });
    });
  
    d3.csv("{% static 'dataset.csv' %}")
      .row(function(d) {
        return {
          key: d.Name,
          values: [+d.Supermarkets, +d.FreshFood, +d.Takeaways, +d.CafeRest]
        };
      })
      .get(function(error, data) {
        var w = 1000;
        var h = 1000;

        var slots = ["0-500", "500-1000", "1000-1500", "1500-2000", "2000-2500", "2500-3000"];
        var rangeX = d3.scaleOrdinal().domain(slots).range([0, w], 500);
        var rangeY = d3.scaleLinear()
          .range([h, 0])
          .domain(
            [0, d3.max(data, function(d, i) {
              return d3.max(d.values);
            })]);
        
        var p = d3.select('body').append('svg').attr('width', w).attr('height', h);
       
        var line = d3.line()
            .x(function(d,i) { return rangeX(slots[i]); })
            .y(function(d,i) { console.log(d); return rangeY(d); });
            
        var color = d3.scaleOrdinal(d3.schemeCategory10);

        var g = p.selectAll(".lineGroup")
          .data(data)
          .enter().append("g")
          .attr("class", function(d,i){
            return "lineGroup " + d.key;
          });

        g.append("path")
          .attr("class", "line")
          .attr("d", function(d) {
            return line(d.values);
          })
          .style("stroke", function(d,i) {
            return color(i);
          })
          .attr("fill","none");


      });
  </script> -->

<script type="text/javascript">

  var margin = {top:0, right:0, bottom:20, left:50},
    width  = 2000,
    height = 500;

var svg = d3.select("body")
    .append("svg")
    .attr("width", "100%")
    .attr("height", "100%")
    .attr("viewBox", "0 0 " + width + " " + height);


    var yScale = d3.scaleLinear()
    .range([height - margin.top - margin.bottom, 0]);

var xScale = d3.scaleBand()
    .rangeRound([0, width - margin.right - margin.left])
    .paddingInner(0.5);

var xAxis = d3.axisBottom(xScale);
var yAxis = d3.axisLeft(yScale);
  

  var xAxisVar = "";
  var yAxisVar = "";
  var operation = "";

    d3.csv("{% static 'dataset.csv' %}", function(error, data){

      var dataValues = d3.values(data)[0];

      var sX = d3.select('body').append('select');
      sX.append('option').text('X Axis Var');
      for(var i=0; i<Object.keys(dataValues).length; i++ ){
        sX.append('option').text(Object.keys(dataValues)[i]);
      }

      var sY = d3.select('body').append('select');
      sY.append('option').text('Y Axis Var');
      for(var i=0; i<Object.keys(dataValues).length; i++ ){
        sY.append('option').text(Object.keys(dataValues)[i]);
      }

      var sO = d3.select('body').append('select');
      sO.append('option').text('Operation');
      sO.append('option').text("Sum");
      sO.append('option').text("Average");
      sO.append('option').text("Max");
      sO.append('option').text("Min");
  
    sX.on('change',function(){
      xAxisVar = this.options[this.selectedIndex].value;
      changeGraph(data, xAxisVar, yAxisVar, operation);
    });
      

    sY.on('change',function(){
      yAxisVar = this.options[this.selectedIndex].value;
      changeGraph(data, xAxisVar, yAxisVar, operation);
    });

    sO.on('change',function(){
      operation = this.options[this.selectedIndex].value;
      changeGraph(data, xAxisVar, yAxisVar, operation);
    });
});

function changeGraph(data, xAxisVar, yAxisVar, operation){
  d3.selectAll("svg > *").remove();
      
    if(operation == "Average") {
      dataNew=d3.nest()
        .key(function(d) {return d[xAxisVar];})
        .rollup(function(d) {
        return d3.mean(d,function(g) {return +g[yAxisVar];});
        })
        .entries(data);
    }else if(operation == "Sum") {
      dataNew=d3.nest()
        .key(function(d) {return d[xAxisVar];})
        .rollup(function(d) {
        return d3.sum(d,function(g) {return +g[yAxisVar];});
        })
        .entries(data);
    }else if(operation == "Max") {
      dataNew=d3.nest()
        .key(function(d) {return d[xAxisVar];})
        .rollup(function(d) {
        return d3.max(d,function(g) {return +g[yAxisVar];});
        })
        .entries(data);
    }else if(operation == "Min") {
      dataNew=d3.nest()
        .key(function(d) {return d[xAxisVar];})
        .rollup(function(d) {
        return d3.min(d,function(g) {return +g[yAxisVar];});
        })
        .entries(data);
    }

    dataNew.sort(function(x, y){
      return d3.ascending(+x["key"], +y["key"]);
    })
    
        

    yScale.domain([0, d3.max(dataNew, function(d){ return d["value"]; })]);

    xScale.domain(dataNew.map(function(d){ return d["key"]; }));


    svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .selectAll(".bar")
    .data(dataNew)
    .enter()
    .append("rect")
    .attr("class", "bar")
    .attr("x", function(d){ return xScale(d["key"]); })
    .attr("y", function(d){ return yScale(d["value"]); })
    .attr("height", function(d){ return height - margin.top - margin.bottom - yScale(d["value"]); })
    .attr("width", xScale.bandwidth());


    svg.append("g")
    .attr("class", "y axis")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .call(yAxis);

//adding x axis to the bottom of chart
svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(" + margin.left + "," + (height - margin.bottom) + ")")
    .call(xAxis);
  }


</script>

   <!--  <script>
      $(document).ready(function(){
        var x = $.ajax({
                   url: "{{url}}/",type:"GET",
                   dataType:"text",
                   success:function(result){
                        console.log("success");
                        console.log(x.responseText);
                },
        error:function(result){
                    console.log(x.responseText)
                }{% static 'dataset.csv' %}
       });
    });
</script> -->
  </body>
</html>